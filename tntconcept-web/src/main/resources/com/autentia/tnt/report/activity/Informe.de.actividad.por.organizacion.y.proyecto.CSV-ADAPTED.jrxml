<?xml version="1.0" encoding="UTF-8"  ?>
		<!--

            TNTConcept Easy Enterprise Management by Autentia Real Bussiness Solution S.L.
            Copyright (C) 2007 Autentia Real Bussiness Solution S.L.

            This program is free software: you can redistribute it and/or modify
            it under the terms of the GNU General Public License as published by
            the Free Software Foundation, either version 3 of the License.

            This program is distributed in the hope that it will be useful,
            but WITHOUT ANY WARRANTY; without even the implied warranty of
            MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
            GNU General Public License for more details.

            You should have received a copy of the GNU General Public License
            along with this program.  If not, see <http://www.gnu.org/licenses/>.

        -->

		<!-- Created with iReport - A designer for JasperReports -->
		<!DOCTYPE jasperReport PUBLIC "//JasperReports//DTD Report Design//EN" "http://jasperreports.sourceforge.net/dtds/jasperreport.dtd">
<jasperReport
		name="Informe.de.actividad.por.organizacion.y.proyecto"
		columnCount="1"
		printOrder="Vertical"
		orientation="Landscape"
		pageWidth="842"
		pageHeight="595"
		columnWidth="782"
		columnSpacing="0"
		leftMargin="30"
		rightMargin="30"
		topMargin="20"
		bottomMargin="20"
		whenNoDataType="AllSectionsNoDetail"
		isTitleNewPage="false"
		isSummaryNewPage="false">
	<property name="ireport.scriptlethandling" value="0" />
	<property name="ireport.encoding" value="UTF-8" />
	<import value="java.util.*" />
	<import value="net.sf.jasperreports.engine.*" />
	<import value="net.sf.jasperreports.engine.data.*" />
	<import value="com.autentia.tnt.util.ConfigurationUtil" />

	<parameter name="Proyecto" isForPrompting="false" class="java.lang.Integer">
		<parameterDescription><![CDATA[Project]]></parameterDescription>
		<defaultValueExpression ><![CDATA[new Integer (1)]]></defaultValueExpression>
	</parameter>

	<parameter name="Fecha inicio" isForPrompting="true" class="java.sql.Timestamp">
		<parameterDescription><![CDATA[Timestamp]]></parameterDescription>
		<defaultValueExpression ><![CDATA[new java.sql.Timestamp(new Date().getTime())]]></defaultValueExpression>
	</parameter>
	<parameter name="Fecha fin" isForPrompting="true" class="java.sql.Timestamp">
		<parameterDescription><![CDATA[Timestamp]]></parameterDescription>
		<defaultValueExpression ><![CDATA[new java.sql.Timestamp(new Date().getTime())]]></defaultValueExpression>
	</parameter>

	<queryString><![CDATA[
	SELECT
		orgName,
		userName,
		start,
		roleName,
		observation,
		COALESCE(fact/60,0) as fact,
		COALESCE(noFact/60,0) as noFact
	FROM (
         SELECT
			 o.name as orgName,
			 r.name as roleName,
			 u.name as userName,
			 a.description as observation,
			 a.start,
			 (CASE WHEN a.billable=1 then a.duration end) as 'fact',
			 (CASE WHEN a.billable=0 then a.duration end) as 'noFact'
         FROM Activity a,ProjectRole r, Organization o, Project p, User u
         WHERE
			 u.id=a.userId and
			 a.roleId = r.id and
			 p.organizationId=o.id and
			 p.id=r.projectId and
			 a.start between $P{Fecha inicio} and $P{Fecha fin} and
			 p.id = $P{Proyecto}
         ORDER BY o.name) as tabla;
	]]>
	</queryString>

	<field name="userName" class="java.lang.String"/>
	<field name="roleName" class="java.lang.String"/>
	<field name="start" class="java.sql.Timestamp"/>
	<field name="fact" class="java.math.BigDecimal"/>
	<field name="noFact" class="java.math.BigDecimal"/>
	<field name="observation" class="java.lang.String"/>

	<title>
		<band height="148"  isSplitAllowed="true" >
			<textField isStretchWithOverflow="true" isBlankWhenNull="false" evaluationTime="Now" hyperlinkType="None"  hyperlinkTarget="Self" >
				<reportElement
						x="0"
						y="0"
						width="74"
						height="18"
						key="staticText-23"/>
				<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
				<textElement textAlignment="Center">
					<font fontName="Verdana" pdfFontName="Helvetica-Bold" size="8" isBold="true"/>
				</textElement>
				<textFieldExpression   class="java.lang.String"><![CDATA["Recurso"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="false" evaluationTime="Now" hyperlinkType="None"  hyperlinkTarget="Self" >
				<reportElement
						x="100"
						y="0"
						width="62"
						height="18"
						key="staticText-6"/>
				<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
				<textElement textAlignment="Center">
					<font fontName="Verdana" pdfFontName="Helvetica-Bold" size="8" isBold="true"/>
				</textElement>
				<textFieldExpression   class="java.lang.String"><![CDATA["Rol"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="false" evaluationTime="Now" hyperlinkType="None"  hyperlinkTarget="Self" >
				<reportElement
						x="200"
						y="0"
						width="62"
						height="18"
						key="staticText-6"/>
				<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
				<textElement textAlignment="Center">
					<font fontName="Verdana" pdfFontName="Helvetica-Bold" size="8" isBold="true"/>
				</textElement>
				<textFieldExpression   class="java.lang.String"><![CDATA["Fecha"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="false" evaluationTime="Now" hyperlinkType="None"  hyperlinkTarget="Self" >
				<reportElement
						x="300"
						y="0"
						width="100"
						height="18"
						key="staticText-24"/>
				<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
				<textElement textAlignment="Center">
					<font fontName="Verdana" pdfFontName="Helvetica-Bold" size="8" isBold="true"/>
				</textElement>
				<textFieldExpression   class="java.lang.String"><![CDATA["Horas Facturables"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="false" evaluationTime="Now" hyperlinkType="None"  hyperlinkTarget="Self" >
				<reportElement
						x="400"
						y="0"
						width="112"
						height="18"
						key="staticText-29"/>
				<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
				<textElement textAlignment="Center">
					<font fontName="Verdana" pdfFontName="Helvetica-Bold" size="8" isBold="true"/>
				</textElement>
				<textFieldExpression   class="java.lang.String"><![CDATA["Horas No Facturables"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="false" evaluationTime="Now" hyperlinkType="None"  hyperlinkTarget="Self" >
				<reportElement
						x="500"
						y="0"
						width="112"
						height="18"
						key="staticText-29"/>
				<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
				<textElement textAlignment="Center">
					<font fontName="Verdana" pdfFontName="Helvetica-Bold" size="8" isBold="true"/>
				</textElement>
				<textFieldExpression   class="java.lang.String"><![CDATA["Observaciones"]]></textFieldExpression>
			</textField>
		</band>
	</title>
	<pageHeader>
		<band height="0"  isSplitAllowed="true" >
		</band>
	</pageHeader>
	<columnHeader>
		<band height="0"  isSplitAllowed="true" >
		</band>
	</columnHeader>
	<detail>
		<band height="72"  isSplitAllowed="true" >
			<textField isStretchWithOverflow="true" isBlankWhenNull="true" evaluationTime="Now" hyperlinkType="None"  hyperlinkTarget="Self" >
				<reportElement
						x="0"
						y="4"
						width="74"
						height="12"
						key="textField-14"/>
				<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
				<textElement textAlignment="Left">
					<font fontName="Verdana" size="8"/>
				</textElement>
				<textFieldExpression   class="java.lang.String"><![CDATA[$F{userName}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true" evaluationTime="Now" hyperlinkType="None"  hyperlinkTarget="Self" >
				<reportElement
						x="100"
						y="4"
						width="74"
						height="12"
						key="textField-13"/>
				<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
				<textElement textAlignment="Left">
					<font fontName="Verdana" size="8"/>
				</textElement>
				<textFieldExpression   class="java.lang.String"><![CDATA[$F{roleName}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="dd/MM/yy" isBlankWhenNull="true" evaluationTime="Now" hyperlinkType="None"  hyperlinkTarget="Self" >
				<reportElement
						x="200"
						y="4"
						width="62"
						height="12"
						key="textField"/>
				<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
				<textElement textAlignment="Center">
					<font fontName="Verdana" size="8"/>
				</textElement>
				<textFieldExpression   class="java.util.Date"><![CDATA[$F{start}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="###0.00" isBlankWhenNull="true" evaluationTime="Now" hyperlinkType="None"  hyperlinkTarget="Self" >
				<reportElement
						x="300"
						y="4"
						width="100"
						height="12"
						key="textField-9"/>
				<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
				<textElement textAlignment="Center">
					<font fontName="Verdana" size="8"/>
				</textElement>
				<textFieldExpression   class="java.math.BigDecimal"><![CDATA[$F{fact}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="###0.00" isBlankWhenNull="true" evaluationTime="Now" hyperlinkType="None"  hyperlinkTarget="Self" >
				<reportElement
						x="400"
						y="4"
						width="112"
						height="12"
						key="textField-9"/>
				<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
				<textElement textAlignment="Center">
					<font fontName="Verdana" size="8"/>
				</textElement>
				<textFieldExpression   class="java.math.BigDecimal"><![CDATA[$F{noFact}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true" evaluationTime="Now" hyperlinkType="None"  hyperlinkTarget="Self" >
				<reportElement
						x="500"
						y="4"
						width="163"
						height="12"
						key="textField"/>
				<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
				<textElement textAlignment="Left">
					<font fontName="Verdana" size="8"/>
				</textElement>
				<textFieldExpression   class="java.lang.String"><![CDATA[$F{observation}]]></textFieldExpression>
			</textField>
		</band>
	</detail>

</jasperReport>

